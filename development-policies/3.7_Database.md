# 3.7 Database

1. ### Database Structure {#database-structure}

![][image4]

2. ### Working with Database Schema (TypeORM) {#working-with-database-schema-(typeorm)}

   1. #### Generate Migration {#generate-migration}

Create entity file with extension .entity.ts. For example post.entity.ts:  
Next, generate migration file:

```
npm run migration:generate -- src/database/migrations/CreatePostTable
```

Apply this migration to database via npm run migration:run.

2. #### Run Migration {#run-migration}

```
npm run migration:run
```

   3. #### Revert Migration {#revert-migration}

```
npm run migration:revert
```

      4. #### Drop All Tables in Database {#drop-all-tables-in-database}

```
npm run schema:drop
```

         5. #### Seeding {#seeding}

```
npm run seed:run
```

      3. ### Performance Optimization {#performance-optimization}

         1. #### Indexes and Foreign Keys {#indexes-and-foreign-keys}

Don't forget to create indexes on the Foreign Keys (FK) columns (if needed), because by default PostgreSQL [does not automatically add indexes to FK](https://stackoverflow.com/a/970605/18140714).

2. #### Max Connections {#max-connections}

Set the optimal number of [max connections](https://node-postgres.com/apis/pool) to database for your application in /.env:

```
DATABASE_MAX_CONNECTIONS=100
```

You can think of this parameter as how many concurrent database connections your application can handle.
